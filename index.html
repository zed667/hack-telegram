<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZED EXE | HACK TELEGRAM</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <meta name="description" content="ZED EXE | HACK TELEGRAM" />
  <style>
    :root {
      --bg: #0b0b0b;
      --panel: #121212;
      --text: #e6e6e6;
      --accent: #00f4ff;
      --accent-2: #00ff95;
      --muted: #9aa0a6;
      --danger: #ff5252;
      --border: #00f4ff33;
    }

    [data-theme="light"] {
      --bg: #ffffff;
      --panel: #ffffff;
      --text: #000000;
      --accent: #00a3b0;
      --accent-2: #00ff95;
      --muted: #000000;
      --danger: #e11d48;
      --border: #00a3b033;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      font-family: Vazirmatn, Tahoma, sans-serif;
      background: radial-gradient(1200px 600px at 50% -200px, #08363a44, transparent), linear-gradient(90deg, var(--bg), 60%, var(--bg));
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 860px;
      padding: 20px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      gap: 10px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      display: grid;
      place-items: center;
      color: #000;
      font-weight: 900;
      box-shadow: 0 10px 30px #00f4ff40;
    }

    .title {
      font-size: 18px;
      font-weight: 800;
      letter-spacing: .3px;
    }

    .subtitle {
      color: var(--muted);
      font-size: 12px;
    }

    .actions {
      display: flex;
      gap: 8px;
    }

    .btn {
      background: var(--accent);
      color: #032d2f;
      border: none;
      border-radius: 12px;
      padding: 10px 14px;
      cursor: pointer;
      font-weight: 700;
      transition: transform .12s ease, filter .2s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn.secondary {
      background: transparent;
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn:hover {
      transform: translateY(-1px);
      filter: saturate(1.1);
    }

    .grid {
      display: grid;
      gap: 16px;
      grid-template-columns: 1fr 1fr;
      align-items: start;
    }

    @media (max-width: 840px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 0 50px #00f4ff22;
      position: relative;
    }

    .panel h2,
    .panel h3 {
      color: var(--accent);
      margin: 0 0 12px;
    }

    .panel p {
      margin: 8px 0;
      color: var(--text);
    }

    .field {
      position: relative;
      margin-bottom: 10px;
    }

    .field input {
      width: 100%;
      padding: 12px 42px 12px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #00000055;
      color: var(--text);
      direction: ltr;
      font-size: 15px;
    }

    .field .toggle-eye {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--accent);
      cursor: pointer;
    }

    .muted {
      color: var(--muted);
      font-size: 12px;
    }

    .error {
      color: var(--danger);
      font-size: 13px;
    }

    .stack {
      display: grid;
      gap: 10px;
    }

    .log-box {
      background: #000000;
      color: #b7f7e8;
      border: 1px solid var(--border);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: 13px;
      padding: 12px;
      height: 260px;
      border-radius: 12px;
      overflow: auto;
    }

    .prompt-top {
      color: var(--accent-2);
      font-weight: 800;
    }

    .prompt-bottom {
      color: var(--accent);
    }

    .typing {
      white-space: pre-wrap;
      direction: ltr;
      unicode-bidi: bidi-override;
    }

    .progress-wrap {
      background: #1f2937;
      height: 10px;
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .progress-bar {
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      height: 100%;
      width: 100%;
      transition: width 1s linear;
    }

    .codeBox {
      font-size: 30px;
      font-weight: 900;
      letter-spacing: 8px;
      color: #b8ffb8;
      background: #041b04;
      text-align: center;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #00ff9555;
    }

    @keyframes glitch {
      0% {
        text-shadow: 2px 0 #ff0040, -2px 0 #00d5ff;
      }

      25% {
        text-shadow: -2px 0 #ff0040, 2px 0 #00d5ff;
      }

      50% {
        text-shadow: 3px 0 #ff0040, -3px 0 #00d5ff;
      }

      75% {
        text-shadow: -3px 0 #ff0040, 3px 0 #00d5ff;
      }

      100% {
        text-shadow: none;
      }
    }

    .glitch {
      animation: glitch .25s steps(2, end) 10;
    }

    .hidden {
      display: none;
    }

    .footer {
      text-align: center;
      margin-top: 12px;
      color: var(--muted);
      font-size: 12px;
    }

    .badge {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      background: #00ff9515;
      border: 1px dashed var(--accent-2);
      color: var(--accent-2);
      font-weight: 700;
    }

    #matrixCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
      background: #000;
      opacity: 0.20;
    }

    /* Ù…ÙˆØ¨Ø§ÛŒÙ„: Ù…Ø§ØªØ±ÛŒÚ©Ø³ Ø³Ø¨Ú© */
    @media (max-width: 900px) {
      #matrixCanvas {
        opacity: 0.15;
      }
    }

    /* Ø¯Ø³Ú©ØªØ§Ù¾: Ù…Ø§ØªØ±ÛŒÚ©Ø³ Ø³Ù†Ú¯ÛŒÙ†â€ŒØªØ± */
    @media (min-width: 900px) {
      #matrixCanvas {
        opacity: 0.28;
      }
    }

    .typingCursor::after {
      content: "â–‹";
      animation: blink 0.7s infinite;
      color: #00f4ff;
    }

    @keyframes blink {

      0%,
      50% {
        opacity: 1;
      }

      50.01%,
      100% {
        opacity: 0;
      }
    }

    .icon-btn {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      border: 1px solid var(--border);
      color: var(--accent);
      background: transparent;
      transition: transform .15s ease, box-shadow .2s ease;
    }

    .icon-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 20px #00f4ff55;
    }

    .crown-btn i {
      font-size: 18px;
    }
  </style>
</head>

<body>

  <div id="warningBox"
    style="position: fixed; top: 0; right: 0; bottom: 0; left: 0; background: rgba(0,0,0,0.85); display: flex; justify-content: center; align-items: center; z-index: 9999;">
    <div
      style="background: #121212; color: #fff; padding: 30px; border-radius: 16px; max-width: 400px; text-align: right; box-shadow: 0 0 30px #00f4ff88; font-family: Vazirmatn;">
      <h3 style="color:#00f4ff; text-align:center;">âš ï¸ Ù†Ú©Ø§Øª Ù…Ù‡Ù…</h3>
      <ul style="font-size: 14px; line-height: 1.8;">
        <li>Ø§Ø² Ø´Ù…Ø§Ø±Ù‡ Ø®ÙˆØ¯ØªÙˆÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†ÛŒÙ† ØªØ§ ØµØ¯Ù…Ù‡â€ŒØ§ÛŒ Ø¨Ù‡ Ú¯ÙˆØ´ÛŒØªÙˆÙ† ÙˆØ§Ø±Ø¯ Ù†Ø´Ù‡. Ø±Ø§Øª Ù…Ø§ Ø®ÛŒÙ„ÛŒ Ø®Ø·Ø±Ù†Ø§Ú©Ù‡.</li>
        <li>ØªÙˆÛŒ Ø¨Ø®Ø´ ØªÙˆÚ©Ù† Ø³Ø± Ø®ÙˆØ¯ Ø¹Ø¯Ø¯ ÛŒØ§ Ù‡Ø± Ú©Ù„Ù…Ù‡â€ŒØ§ÛŒ ÙˆØ§Ø±Ø¯ Ù†Ú©Ù†ÛŒÙ† Ú†ÙˆÙ† Ø¨Ù† Ù…ÛŒâ€ŒØ´ÛŒØ¯ Ø§Ø² Ø³Ø§ÛŒØª.</li>
        <li>Ù‡Ø± Ú©Ø§Ø±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ Ø¨Ø± Ø¹Ù‡Ø¯Ù‡ Ø®ÙˆØ¯ØªÙˆÙ†Ù‡ Ùˆ Ù…Ø§ Ù‡ÛŒÚ† Ù…Ø³Ø¦ÙˆÙ„ÛŒØªÛŒ Ù‚Ø¨ÙˆÙ„ Ù†Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….</li>
        <li>Ø³Ø¹ÛŒ Ú©Ù†ÛŒÙ† Ø§Ø² Ø³Ø§ÛŒØª Ù…Ø§ Ø¯Ø±Ø³Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒÙ† Ùˆ Ø¨Ù‡ Ú©Ø³ÛŒ Ø¢Ø³ÛŒØ¨ Ù†Ø±Ø³ÙˆÙ†ÛŒÙ†.</li>
        <li>Ø§ÛŒÙ† Ø³Ø§ÛŒØª Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ Ú©Ù‡ Ú©Ø³ÛŒ Ù†ØªÙˆÙ†Ù‡ Ø³ÙˆØ¡Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ù‡</li>
      </ul>
      <button onclick="hideWarning()"
        style="width: 100%; margin-top: 20px; padding: 12px; background: #00f4ff; color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">ÙÙ‡Ù…ÛŒØ¯Ù…</button>
    </div>
  </div>

  <canvas id="matrixCanvas"></canvas>

  <div class="app" id="app">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true">ZED</div>
        <div>
          <div class="title">Ù‡Ú© ØªÙ„Ú¯Ø±Ø§Ù…</div>
          <div class="subtitle">Ø¢Ù†Ú†Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØŒ ØªÙˆ Ø±Ø§ Ù…ÛŒâ€ŒØ³Ø§Ø²Ø¯â€¦ Ø§Ù…Ø§ Ù†Ù‡ Ø¨Ù‡ ÙˆÙ‚Øª ØªÙˆ.</div>
        </div>
      </div>
      <div class="actions">
        <!-- Ø¢ÛŒÚ©Ù† ØªØ§Ø¬ -->
        <a href="game.html" class="icon-btn crown-btn" aria-label="Game">
          <i class="fa-solid fa-crown"></i>
        </a>

        <!-- Ø¯Ú©Ù…Ù‡ ØµØ¯Ø§ -->
        <button class="btn secondary" id="toggleSound" aria-label="ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª ØµØ¯Ø§">
          <i class="fa-solid fa-volume-high"></i><span>ØµØ¯Ø§</span>
        </button>
      </div>
    </div>

    <div class="grid">
      <!-- Step 1 -->
      <section class="panel" id="step1">
        <h2><i class="fa-solid fa-shield-halved"></i>Ø´Ø±ÙˆØ¹ Ù‡Ú©</h2>
        <p class="muted">âš ï¸ Ù‚Ø¨Ù„ Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ Ø§ÛŒÙ†Ø¬Ø§ Ø´Ù…Ø§Ø±Ù‡ Ø±Ùˆ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒÙ† ØªÙˆ ØªÙ„Ú¯Ø±Ø§Ù… ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ø¹Ø¯ Ø§ÛŒÙ†Ø¬Ø§</p>
        <div class="stack">
          <div class="field">
            <input id="phone" type="password" placeholder="09123456789" aria-label="Ø´Ù…Ø§Ø±Ù‡" />
            <span class="toggle-eye" onclick="toggleVisibility('phone', this)"><i class="fas fa-lock"></i></span>
          </div>
          <div class="field">
            <input id="tokenInput" type="password" placeholder="ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† ØªÙˆÚ©Ù†" aria-label="ØªÙˆÚ©Ù†" />
            <span class="toggle-eye" onclick="toggleVisibility('tokenInput', this)"><i class="fas fa-lock"></i></span>
          </div>
          <p style="font-size: 12px; color: #818181; margin: -5px 0 10px;">
            ğŸ’» Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª ØªÙˆÚ©Ù† Ø¨Ø§ Ø¢ÛŒØ¯ÛŒ <a href="https://t.me/hexdix" target="_blank" style="color:#00f4ff">@hexdix</a>
            Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§Ø´ÛŒØ¯.
          </p>
          <div id="error" class="error"></div>
          <button class="btn" id="btnStart"><i class="fa-solid fa-play"></i>Ø´Ø±ÙˆØ¹ Ø¨Ø±Ø³ÛŒ</button>
        </div>
      </section>

      <!-- Step 2 -->
      <section class="panel hidden" id="step2">
        <h3>ğŸ“¡ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ú© ØªÙ„Ú¯Ø±Ø§Ù…</h3>
        <div class="log-box" id="logBox" aria-live="polite" aria-atomic="false"></div>
        <div class="stack">
          <div id="timer" class="muted">â± Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: â€”</div>
          <div class="progress-wrap">
            <div class="progress-bar" id="progressBar"></div>
          </div>
        </div>
      </section>

      <!-- === Step 3 (AI Interview / Guard) === -->
      <section class="panel hidden" id="step3">
        <h3>Ø³Ù„Ø§Ù… Ù…Ù† ÛŒÚ© Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¨Ø§Ø²Ø¬ÙˆÛŒÛŒ Ù‡Ø³ØªÙ…</h3>
        <p class="muted">Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡: Ù„Ø·ÙØ§Ù‹ ØµØ§Ø¯Ù‚Ø§Ù†Ù‡ Ùˆ Ú©Ø§Ù…Ù„ Ù¾Ø§Ø³Ø® Ø¨Ø¯Ù‡. Ù‡Ø± Ù¾Ø§Ø³Ø® Ù…Ø´Ú©ÙˆÚ© ÛŒØ§ Ø§Ø´Ø§Ø±Ù‡ Ø¨Ù‡ Ù‡Ø¯ÙÙ Ø¢Ø³ÛŒØ¨â€ŒØ±Ø³Ø§Ù†ÛŒ Ø¨Ø§Ø¹Ø«
          Ù…ØªÙˆÙ‚Ùâ€ŒØ´Ø¯Ù† ÙØ±Ø§ÛŒÙ†Ø¯ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡Ù” Ø§Ù…Ù† Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.</p>

        <div class="stack" style="gap:12px;">
          <div id="aiPrompt" style="min-height:70px; font-weight:700; direction: rtl;"></div>

          <textarea id="aiAnswer" placeholder="Ù„Ø·ÙØ§Ù‹ Ø¬ÙˆØ§Ø¨ Ú©Ø§Ù…Ù„ Ùˆ ÙˆØ§Ø¶Ø­ Ø¨Ù†ÙˆÛŒØ³"
            style="width:100%; min-height:110px; padding:12px; border-radius:10px; border:1px solid var(--border); background: #00000055; color:var(--text); resize:vertical;"></textarea>

          <div style="display:flex; gap:10px; align-items:center;">
            <button class="btn" id="aiSubmit"><i class="fa-solid fa-paper-plane"></i> Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®</button>
            <button class="btn secondary" id="aiCancel">Ø§Ù†ØµØ±Ø§Ù / Ø®Ø±ÙˆØ¬</button>
            <div id="aiStatus" class="muted" style="margin-left:auto; font-size:13px;"></div>
          </div>

          <div id="aiFollow" class="muted" style="font-size:13px; min-height:24px;"></div>
        </div>
      </section>


      <!-- Step 4 -->
      <section class="panel hidden" id="step4">
        <h3>âŒ› Ø´Ù…Ø§Ø±Ø´ Ù…Ø¹Ú©ÙˆØ³</h3>
        <div class="typing" id="countdown" style="font-size:18px; font-weight:700;">10</div>
      </section>

      <!-- Step 5 -->
      <section class="panel hidden" id="step5">
        <h3>Ú©Ø¯ Ø´Ù…Ø§</h3>
        <div class="codeBox" id="codeBox" aria-live="polite"></div>
        <div class="footer"><span class="badge">Ø§Ø² Ú©Ø¯ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯</span></div>
        <div style="margin-top:12px; display:flex; gap:8px;">
          <button class="btn secondary" id="btnShowErrors">Ú©Ø¯ Ø¯Ø±Ø³Øª Ù†Ø¨ÙˆØ¯ØŸ</button>
          <button class="btn" id="btnRestart"><i class="fa-solid fa-rotate-right"></i> Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
        </div>
      </section>

      <!-- Step 6 -->
      <section class="panel hidden" id="step6">
        <h3>ğŸ“› Ø¯Ù„Ø§ÛŒÙ„ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ Ø§Ø´ØªØ¨Ø§Ù‡ Ø¨ÙˆØ¯Ù† Ú©Ø¯:</h3>
        <ul style="margin:0 1rem; line-height:1.9;">
          <li>Ø´Ù…Ø§Ø±Ù‡ Ø¨Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡</li>
          <li>Ø­Ø³Ø§Ø¨ Ø¯Ø± Ù„ÛŒØ³Øª Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù…ÙˆÙ‚Øª Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯</li>
          <li>Ú©Ø¯ Ù…ÙˆÙ‚ØªÛŒ Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª</li>
          <li>Ø³Ø±ÙˆØ± ØªÙ„Ú¯Ø±Ø§Ù… Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ Ú©Ù†Ø¯ Ø§Ø³Øª</li>
        </ul>
        <div style="margin-top:12px; display:flex; gap:8px;">
          <button class="btn" id="btnRetry"><i class="fa-solid fa-rotate-right"></i> ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯</button>
          <button class="btn secondary" id="btnBackHome">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø´Ø±ÙˆØ¹</button>
        </div>
      </section>
    </div>

    <!-- Modal Ø¨Ø±Ø§ÛŒ Ù‡Ø´Ø¯Ø§Ø± ØªØ§ÛŒÛŒØ¯ Ø¯Ùˆ Ù…Ø±Ø­Ù„Ù‡ -->
    <div id="twoStepBox" style="position: fixed; top: 0; right: 0; bottom: 0; left: 0;
         background: rgba(0,0,0,0.85); display: none; justify-content: center;
         align-items: center; z-index: 10000;">
      <div style="background: #121212; color: #fff; padding: 30px; border-radius: 16px;
              max-width: 400px; text-align: center; box-shadow: 0 0 30px #00f4ff88;
              font-family: Vazirmatn;">
        <h3 style="color:#00f4ff;">â„¹ï¸ Ù†Ú©ØªÙ‡ Ù…Ù‡Ù…</h3>
        <p style="font-size: 14px; line-height: 1.8;">
          Ø¯Ø±ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ø§Ú©Ø§Ù†Øª ØªÙ„Ú¯Ø±Ø§Ù… ØªØ§Ø±Ú¯Øª ØªØ§ÛŒÛŒØ¯ Ø¯Ùˆ Ù…Ø±Ø­Ù„Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡ Ù‡ÛŒÚ†Ø¬ÙˆØ±Ù‡ Ù†Ù…ÛŒØªÙˆÙ†ÛŒ ÙˆØ§Ø±Ø¯ Ø§Ú©Ø§Ù†ØªØ´ Ø´ÛŒ
        </p>
        <button onclick="hideTwoStepBox()" style="margin-top: 20px; padding: 12px; background: #00f4ff; color: #000;
             border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
          ÙÙ‡Ù…ÛŒØ¯Ù…
        </button>
      </div>
    </div>

    <div class="footer">Ø³Ø§Ø®ØªÙ‡â€ŒØ´Ø¯Ù‡ ØªÙˆØ³Ø· ØªÛŒÙ… ZED EXE</div>
  </div>

  <script>
    // ======== Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ ========
    const Steps = Object.freeze({
      INPUT: 1, LOGS: 2, VERIFY: 3, COUNTDOWN: 4, CODE: 5, HINTS: 6
    });

    let currentStep = Steps.INPUT;
    let soundEnabled = true;

    const qs = (sel) => document.querySelector(sel);
    const qsa = (sel) => Array.from(document.querySelectorAll(sel));

    function goTo(step) {
      currentStep = step;
      const ids = ['step1', 'step2', 'step3', 'step4', 'step5', 'step6'];
      ids.forEach((id, idx) => {
        const el = qs('#' + id);
        if (!el) return;
        const visible = (idx + 1) === step;
        el.classList.toggle('hidden', !visible);
      });
    }

    // ======== ØªÙ… Ùˆ ØµØ¯Ø§ ========
    qs('#toggleSound').addEventListener('click', () => {
      soundEnabled = !soundEnabled;
      qs('#toggleSound i').className = 'fa-solid ' + (soundEnabled ? 'fa-volume-high' : 'fa-volume-xmark');
    });

    // ======== Ø§Ø¨Ø²Ø§Ø± ØµØ¯Ø§ ========
    const Audio = (() => {
      let ctx;
      function ensure() { if (!ctx) ctx = new (window.AudioContext || window.webkitAudioContext)(); }
      function beep(freq = 880, dur = 0.05, type = 'square', vol = 0.02) {
        if (!soundEnabled) return;
        ensure();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = type; o.frequency.value = freq;
        g.gain.value = vol; o.connect(g); g.connect(ctx.destination);
        o.start(); setTimeout(() => o.stop(), dur * 1000);
      }
      return { beep };
    })();

    // ======== ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ ========
    const phoneEl = qs('#phone');
    const tokenEl = qs('#tokenInput');
    const errEl = qs('#error');

    // ======== Ø§Ú©Ø´Ù†â€ŒÙ‡Ø§ ========
    qs('#btnStart').addEventListener('click', startDemo);
    qs('#btnShowErrors').addEventListener('click', () => goTo(Steps.HINTS));
    qs('#btnRestart').addEventListener('click', resetAll);
    qs('#btnRetry').addEventListener('click', resetAll);
    qs('#btnBackHome').addEventListener('click', () => goTo(Steps.INPUT));

    function resetAll() {
      phoneEl.value = '';
      tokenEl.value = '';
      qs('#logBox').innerHTML = '';
      qs('#timer').textContent = 'â± Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: â€”';
      qs('#progressBar').style.width = '100%';
      goTo(Steps.INPUT);
    }

    function startDemo() {
      const phone = phoneEl.value.trim();
      const token = tokenEl.value.trim();

      // Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ
      localStorage.setItem("ghost_phone", phone);
      localStorage.setItem("ghost_token", token);

      // Ú†Ú© Ø´Ù…Ø§Ø±Ù‡
      if (!/^09\d{9}$/.test(phone)) {
        errEl.textContent = "Ø´Ù…Ø§Ø±Ù‡ Ø¨Ø§ÛŒØ¯ Ø§ÛŒØ±Ø§Ù†ÛŒ Ùˆ 11 Ø±Ù‚Ù…ÛŒ Ø¨Ø§Ø´Ø¯.";
        Audio.beep(200, 0.15, "sawtooth", 0.03);
        return;
      }

      // Ú†Ú© ØªÙˆÚ©Ù†
      if (token.length === 0) {
        errEl.textContent = "ØªÙˆÚ©Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.";
        Audio.beep(200, 0.15, "sawtooth", 0.03);
        return;
      }

      // ØªÙˆÚ©Ù† Ø§Ø´ØªØ¨Ø§Ù‡ â†’ Ø¨Ø¯ÙˆÙ† Ø§Ø±Ø±ÙˆØ±
      if (token !== "5jWjSzP2XlIa9") {
        errEl.textContent = "";
        Audio.beep(300, 0.05, "square", 0.01);
        return;
      }

      // ÙˆØ±ÙˆØ¯ Ø¨Ù‡ ÙØ§Ø² AI
      errEl.textContent = "";
      goTo(Steps.LOGS);

      const logBox = qs("#logBox");
      logBox.innerHTML = "";

      // -------------------- ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ù¾ÙˆÛŒØ§ --------------------

      function randomHex(len = 8) {
        return [...Array(len)]
          .map(() => Math.floor(Math.random() * 16).toString(16))
          .join("");
      }

      function randomPercent() {
        return (Math.random() * 100).toFixed(1) + "%";
      }

      function randomRisk() {
        const r = Math.random();
        if (r < 0.33) return "Ú©Ù…";
        if (r < 0.66) return "Ù…ØªÙˆØ³Ø·";
        return "Ø²ÛŒØ§Ø¯";
      }

      const AI_POOL = [
        "Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡...",
        "Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø±ÙØªØ§Ø± Ú©Ø§Ø±Ø¨Ø±...",
        "Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø§Ù…Ù†ÛŒØªÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯...",
        "Ø¯Ø± Ø­Ø§Ù„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ú¯ÙˆÛŒ ØªØ§ÛŒÙ¾...",
        "Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ...",
        "Ø¢Ù†Ø§Ù„ÛŒØ² Ù„Ø§ÛŒÙ‡ Ø¯ÙˆÙ… ÙØ¹Ø§Ù„ Ø´Ø¯...",
        "Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§Ø®ØªØ§Ø± ÙˆØ±ÙˆØ¯ÛŒ...",
        "Ø³Ù†Ø¬Ø´ Ù…ÛŒØ²Ø§Ù† Ø±ÛŒØ³Ú©...",
        "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ fingerprint Ø±ÙØªØ§Ø±ÛŒ...",
        "Ù…Ø­Ø§Ø³Ø¨Ù‡ entropy...",
        "Ø¨Ø±Ø±Ø³ÛŒ Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§...",
        "ÙˆØ§Ø±Ø³ÛŒ Ø§ØªØµØ§Ù„ Ø³ÛŒØ³ØªÙ…...",
        "Ø³Ø§Ø²Ú¯Ø§Ø± Ø³Ø§Ø²ÛŒ Ù…Ø¯Ù„ AI...",
        "ØªÙ‡ÛŒÙ‡ Ù‡Ø´ Ø§Ù…Ù†ÛŒØªÛŒ...",
        "Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ...",
      ];

      function generateAILine() {
        const base = AI_POOL[Math.floor(Math.random() * AI_POOL.length)];

        const patterns = [
          `${base}`,
          `${base} | Ù‡Ø´: ${randomHex()}`,
          `${base} | Ù¾Ø±Ø¯Ø§Ø²Ø´: ${randomPercent()}`,
          `${base} | Ø±ÛŒØ³Ú©: ${randomRisk()}`,
          `${base} | Ú©Ø¯: #${randomHex(6)}`,
          `${base} | Ø³ÛŒÚ©Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´: ${Math.floor(Math.random() * 900 + 100)}`,
        ];

        return patterns[Math.floor(Math.random() * patterns.length)];
      }

      function pickDynamicLines() {
        const pool = new Set();
        const count = 5 + Math.floor(Math.random() * 3);

        while (pool.size < count) {
          pool.add(generateAILine());
        }

        return [...pool];
      }

      // -------------------- ØªØ§ÛŒÙ¾ Ø®Ø· Ø¨Ù‡ Ø®Ø· --------------------

      const aiLines = pickDynamicLines();
      let index = 0;

      function typeLine(text, done) {
        const el = document.createElement("div");
        el.style.color = "#00f4ff";
        el.style.margin = "8px 0";
        el.style.fontFamily = "monospace";
        logBox.appendChild(el);

        let i = 0;
        function typer() {
          if (i <= text.length) {
            el.textContent = text.slice(0, i);
            i++;
            setTimeout(typer, 20 + Math.random() * 15);
          } else {
            done(el);
          }
        }
        typer();
      }

      function deleteLine(el, done) {
        let txt = el.textContent;
        let i = txt.length;

        function erase() {
          if (i >= 0) {
            el.textContent = txt.slice(0, i);
            i--;
            setTimeout(erase, 12 + Math.random() * 10);
          } else {
            el.remove();
            done();
          }
        }
        erase();
      }

      function runAI() {
        if (index < aiLines.length) {
          typeLine(aiLines[index], (el) => {
            setTimeout(() => {
              deleteLine(el, () => {
                index++;
                runAI();
              });
            }, 800 + Math.random() * 600);
          });
        } else {
          showValidation();
        }
      }

      // -------------------- Ù†Ù…Ø§ÛŒØ´ ØªØ§ÛŒÛŒØ¯ --------------------

      function showValidation() {
        const el = document.createElement("div");
        el.style.color = "#0f0";
        el.style.fontFamily = "monospace";
        el.style.marginTop = "12px";

        el.innerHTML = `
      Ø´Ù…Ø§Ø±Ù‡: ${phone} âœ” Ù…Ø¹ØªØ¨Ø±<br>
      ØªÙˆÚ©Ù† : ${token} âœ” ØªØ§ÛŒÛŒØ¯ Ø´Ø¯<br><br>
    `;

        logBox.appendChild(el);
        setTimeout(checkPhoneStatus, 900 + Math.random() * 600);
      }

      function checkPhoneStatus() {
        const el = document.createElement("div");
        el.style.color = "#00f4ff";
        el.style.fontFamily = "monospace";
        logBox.appendChild(el);

        typeLine("Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ø´Ù…Ø§Ø±Ù‡...", () => {
          setTimeout(() => {
            const ok = Math.random() < 0.99;

            if (ok) {
              el.innerHTML += "<br>âœ” Ø´Ù…Ø§Ø±Ù‡ ÙØ¹Ø§Ù„ Ø§Ø³Øª.";
              setTimeout(() => {
                goTo(Steps.LOGS);
                runLogs(phone, token);
              }, 900);
            } else {
              el.innerHTML += "<br>âœ– Ø´Ù…Ø§Ø±Ù‡ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª.";
              errEl.textContent = "Ø´Ù…Ø§Ø±Ù‡ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³ØªØŒ Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ Ø¯ÛŒÚ¯Ø±ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.";
            }
          }, 700 + Math.random() * 400);
        });
      }

      // Ø´Ø±ÙˆØ¹
      runAI();
    }



    // ======== Ú˜Ù†Ø±Ø§ØªÙˆØ± Ù„Ø§Ú¯â€ŒÙ‡Ø§ ========
    const LOG_POOL = [
      'ping example.com -c 4',
      'nslookup demo.local',
      'curl -I https://httpbin.org/status/200',
      'openssl rand -hex 8',
      'traceroute 1.1.1.1',
      'whois example.org',
      'dig +short txt demo.training',
      'nmap -sS 127.0.0.1',
      'gzip --test sample.log.gz',
      'jq \'{status: \'\'ok\'\'}\'',
      'node -e "console.log(\'demo\')"',
      'python - <<PY\nprint(\'hello demo\')\nPY',
      'git status --porcelain',
      'docker ps --format "table {{.Names}}\t{{.Status}}"',
      'kubectl version --client',
      'echo $RANDOM',
      'sleep 0.1 && echo done',
    ];

    function pickLogs(count = 10) {
      const pool = [...LOG_POOL];
      const out = [];
      for (let i = 0; i < count && pool.length; i++) {
        const idx = Math.floor(Math.random() * pool.length);
        out.push(pool.splice(idx, 1)[0]);
      }
      // Ú©Ù…ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡ Ø¨Ø§ Ø¯Ø§Ø¯Ù‡ Ú©Ø§Ø±Ø¨Ø± (Ù†Ù…Ø§ÛŒØ´ÛŒ)
      out.splice(2, 0, `INIT session for id:${mask(phoneEl.value.trim())}`);
      out.push(`[OK] synthetic-workload: ${Math.floor(Math.random() * 1000)} ops`);
      out.push(`[OK] pseudo-checksum: ${Math.random().toString(16).slice(2, 10)}`);
      out.push('[DONE] pipeline complete');
      return out;
    }

    function mask(v) { return v.replace(/\d(?=\d{3})/g, 'â€¢'); }

    function runLogs() {
      const logBox = qs('#logBox');
      logBox.innerHTML = '';

      let i = 0; let timer = 12; // Ø«Ø§Ù†ÛŒÙ‡
      const logs = pickLogs(9);
      qs('#timer').textContent = `â± Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${timer} Ø«Ø§Ù†ÛŒÙ‡`;
      const progressBar = qs('#progressBar');

      function typeLine(line, done) {
        const wrap = document.createElement('div');

        const top = document.createElement('div');
        top.className = 'prompt-top';
        top.textContent = 'â”Œâ”€[demo@cterm]â”€[~/sandbox]';
        top.style.direction = 'ltr';

        const bottom = document.createElement('div');
        bottom.className = 'prompt-bottom';
        bottom.innerHTML = '<span>â””â”€â”€â•¼&gt; $ </span><span class="typing"></span>';
        bottom.style.direction = 'ltr';

        const out = bottom.querySelector('.typing');

        wrap.appendChild(top);
        wrap.appendChild(bottom);
        logBox.appendChild(wrap);

        wrap.appendChild(top); wrap.appendChild(bottom);
        logBox.appendChild(wrap);

        // ØªØ§ÛŒÙ¾ Ù…ØªØºÛŒØ± Ø³Ø±Ø¹Øª
        let idx = 0;
        const base = 12 + Math.random() * 24; // ms per char
        function tick() {
          if (idx < line.length) {
            out.textContent += line[idx++];
            if (idx % 4 === 0) Audio.beep(1200, 0.01, 'square', 0.01);
            logBox.scrollTop = logBox.scrollHeight;
            setTimeout(tick, base * (0.75 + Math.random() * 0.5));
          } else { done(); }
        }
        tick();
      }

      function next() {
        if (i < logs.length) {
          typeLine(logs[i], () => {
            i++; timer = Math.max(0, timer - 1);
            qs('#timer').textContent = `â± Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${timer} Ø«Ø§Ù†ÛŒÙ‡`;
            progressBar.style.width = `${Math.max(0, (logs.length - i) / logs.length * 100)}%`;
            next();
          });
        } else {
          setTimeout(() => { goTo(Steps.VERIFY); }, 400);
        }
      }

      next();
    }

    // ======== Ø´Ù…Ø§Ø±Ø´ Ù…Ø¹Ú©ÙˆØ³ ========
    function startCountdown() {
      const el = qs('#countdown');
      let sec = 10;
      function tick() {
        el.textContent = `\u202Bâ³ ${sec} Ø«Ø§Ù†ÛŒÙ‡ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡...`;
        Audio.beep(700 + (10 - sec) * 20, 0.03, 'triangle', 0.012);
        if (sec-- > 0) setTimeout(tick, 1000);
        else showCode();
      }

      tick();
    }

    // ======== Ú©Ø¯ Ù†Ù…Ø§ÛŒØ´ÛŒ ========
    function showCode() {
      goTo(Steps.CODE);
      const code = (10000 + Math.floor(Math.random() * 89999)).toString();
      const box = qs('#codeBox');
      box.textContent = code;
      box.classList.remove('glitch');
      void box.offsetWidth;
      box.classList.add('glitch');
      // Ø§ÙÚ©Øª ØµÙˆØªÛŒ
      for (let i = 0; i < 8; i++) setTimeout(() => Audio.beep(440 + i * 40, 0.04, 'square', 0.02), i * 45);

      //  Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø¹Ø¯ Ø§Ø² 2 Ø«Ø§Ù†ÛŒÙ‡
      setTimeout(() => {
        document.getElementById("twoStepBox").style.display = "flex";
      }, 2000);
    }


    // ======== Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ ========
    function toggleVisibility(inputId, iconWrapper) {
      const input = document.getElementById(inputId);
      const hidden = input.type === 'password';
      input.type = hidden ? 'text' : 'password';
      iconWrapper.innerHTML = `<i class="fas fa-${hidden ? 'lock-open' : 'lock'}"></i>`;
    }
    function hideWarning() {
      document.getElementById("warningBox").style.display = "none";
    }

    function hideTwoStepBox() {
      document.getElementById("twoStepBox").style.display = "none";
    }
    // MATRIX
    const canvas = document.getElementById("matrixCanvas");
    const ctx = canvas.getContext("2d");

    function matrixSetup() {
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;

      const hexChars = "0123456789ABCDEF";
      const ghostHex = ["49", "4D", "20", "47", "48", "4F", "53", "54"];

      const fontSize = window.innerWidth < 900 ? 12 : 16;
      const columns = Math.floor(canvas.width / (fontSize * 1.2));
      const drops = Array(columns).fill(1);

      function draw() {
        ctx.fillStyle = "rgba(0,0,0,0.06)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = "#00ff95";
        ctx.font = `${fontSize}px monospace`;

        for (let i = 0; i < drops.length; i++) {
          const text = Math.random() > 0.98
            ? ghostHex[Math.floor(Math.random() * ghostHex.length)]
            : hexChars[Math.floor(Math.random() * hexChars.length)];

          ctx.fillText(text, i * fontSize, drops[i] * fontSize);

          if (drops[i] * fontSize > canvas.height && Math.random() > 0.93)
            drops[i] = 0;

          drops[i]++;
        }
      }

      setInterval(draw, window.innerWidth < 900 ? 65 : 50);
    }

    matrixSetup();
    window.addEventListener("resize", matrixSetup);

    // ===== ØªÙ†Ø¸ÛŒÙ…Ø§Øª =====
    const AI_QUESTIONS = [
      "Ù‡Ø¯Ù Ø´Ù…Ø§ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ú†ÛŒØ³ØªØŸ Ù„Ø·ÙØ§Ù‹ ÙˆØ§Ø¶Ø­ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯.",
      "Ø§ÛŒÙ† Ø´Ù…Ø§Ø±Ù‡ Ù…Ø§Ù„Ú©ÛŒØªØ´ Ø¨Ø§ Ú†Ù‡ Ú©Ø³ÛŒ Ø§Ø³ØªØŸ (Ø®ÙˆØ¯Ù… / Ø¯ÙˆØ³Øª / Ø´Ø®Øµ Ø¯ÛŒÚ¯Ø±) Ù„Ø·ÙØ§Ù‹ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡.",
      "Ø¢ÛŒØ§ ØµØ§Ø­Ø¨ Ø§Ú©Ø§Ù†Øª ØµØ±ÛŒØ­Ø§Ù‹ Ø±Ø¶Ø§ÛŒØª Ø¯Ø§Ø¯Ù‡ØŸ Ø§Ú¯Ø± Ø¨Ù„Ù‡ØŒ Ú†Ú¯ÙˆÙ†Ù‡ØŸ",
      "Ø¢ÛŒØ§ Ø§ÛŒÙ† Ø§Ù‚Ø¯Ø§Ù… Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù…Ù†ÛŒØª Ø®ÙˆØ¯Ù Ø´Ù…Ø§Ø³Øª ÛŒØ§ Ø¨Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ",
      "Ø¢ÛŒØ§ ØªØ¶Ù…ÛŒÙ†ÛŒ Ø¨Ø±Ø§ÛŒ Ø¢Ø³ÛŒØ¨ Ù†Ù†Ø¯Ø§Ø´ØªÙ† Ø¨Ù‡ Ø´Ø®Øµ Ø¯ÛŒÚ¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ØŸ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡.",
      "Ú†Ù‡ ØªØ¶Ù…ÛŒÙ†ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ Ú©Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ§Ø±Ø¯Ø´Ø¯Ù‡ Ø¨Ù‡â€ŒØ¬Ø§ÛŒÛŒ Ù†Ø´Øª Ù†Ú©Ù†Ø¯ØŸ"
    ];

    const FOLLOWUP_QUESTIONS = [
      "Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†: Ù„Ø·ÙØ§Ù‹ Ø¨Ù†ÙˆÛŒØ³ Â«Ù…Ù† Ù…Ø§Ù„Ú© Ø´Ù…Ø§Ø±Ù‡ Ù‡Ø³ØªÙ…Â» ÛŒØ§ Â«Ù…Ø§Ù„Ú© Ù†ÛŒØ³ØªÙ…Â» Ùˆ Ù…Ø®ØªØµØ±Ø§Ù‹ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡ Ú†Ø±Ø§.",
      "Ø¨Ø±Ø§ÛŒ Ù…Ø­Ú©Ù…â€ŒÚ©Ø§Ø±ÛŒ: Ù„Ø·ÙØ§Ù‹ Ø¨Ù†ÙˆÛŒØ³ Ú†Ú¯ÙˆÙ†Ù‡ Ø§Ø² ØµØ§Ø­Ø¨ Ø´Ù…Ø§Ø±Ù‡ Ø§Ø¬Ø§Ø²Ù‡ Ú¯Ø±ÙØªÛŒ ÛŒØ§ Ú†Ø±Ø§ Ø§Ø¯Ø¹Ø§ÛŒ Ù…Ø§Ù„Ú©ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†ÛŒ.",
      "ÛŒÚ© Ø¬Ù…Ù„Ù‡ ÙˆØ§Ø¶Ø­ Ø¯Ø±Ø¨Ø§Ø±Ù‡Ù” Ù‡Ø¯Ù Ø¨Ú¯Ùˆ â€” Ø§Ú¯Ø± Ù‡Ø¯Ù Â«ØªØ³Øª Ø§Ù…Ù†ÛŒØª Ø±ÙˆÛŒ Ø§Ú©Ø§Ù†Øª Ø®ÙˆØ¯Ù…Â» Ø§Ø³ØªØŒ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡."
    ];

    const ACCEPT_PATTERNS = [
      "ØªØ³Øª Ø§Ù…Ù†ÛŒØª", "ØªØ³Øª Ø§Ú©Ø§Ù†Øª", "Ø§Ù…Ù†ÛŒØª Ø§Ú©Ø§Ù†Øª", "Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ¯Ù…", "Ø§Ø² Ø®ÙˆØ¯Ù…",
      "Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ¯Ù… Ù‡Ø³Øª", "Ù…Ù† ØµØ§Ø­Ø¨", "Ù…Ø§Ù„Ú© Ù‡Ø³ØªÙ…", "Ù…Ù† Ù…Ø§Ù„Ú© Ø´Ù…Ø§Ø±Ù‡ Ù‡Ø³ØªÙ…",
      "Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø§Ø±Ù…", "Ø±Ø¶Ø§ÛŒØª Ø¯Ø§Ø±Ù…", "owner", "i consent"
    ];

    const REJECT_PATTERNS = [
      "Ù‡Ú©", "hack", "crack", "Ø¯ÙˆØ± Ø²Ø¯Ù†", "Ø¨Ø¯ÙˆÙ† Ø§Ø¬Ø§Ø²Ù‡", "Ø¨Ø¯ÙˆÙ† Ø±Ø¶Ø§ÛŒØª", "Ø±Ù…Ø²", "password", "Ù¾Ø³ÙˆØ±Ø¯",
      "Ø¯ÙˆØ³Øª", "Ø¯ÙˆØ³ØªÙ…", "Ø¯ÙˆØ³ØªÙ…Ù‡", "Ø±ÙÛŒÙ‚", "Ø±ÙÛŒÙ‚Ù…", "Ø§Ú©Ø³", "Ø¹Ø§Ø´Ù‚", "Ø±ÙÙ„", "Ù¾Ø§Ø±ØªÙ†Ø±",
      "Ú†Ú© Ú©Ù†Ù…", "Ø¨Ø±Ø³ÛŒ Ú©Ù†Ù…", "Ù…ÛŒØ®ÙˆØ§Ù… Ø¨Ø¨ÛŒÙ†Ù… Ø®ÛŒØ§Ù†Øª Ú©Ø±Ø¯Ù‡", "Ù…ÛŒØ®ÙˆØ§Ù… Ø¨ÙÙ‡Ù…Ù… Ø¨Ø§ Ú©ÛŒ Ø­Ø±Ù Ù…ÛŒØ²Ù†Ù‡",
      "Ø±Ø¯ ÛŒØ§Ø¨", "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ", "Ø´Ù…Ø§Ø±Ù‡ Ú©Ø³"
    ];

    const LIE_INDICATORS = [
      "Ù…Ù† Ø®ÙˆØ¯Ù… Ù†ÛŒØ³ØªÙ…", "Ø¯ÙˆØ³ØªÙ… Ú¯ÙØªÙ‡", "ÛŒÚ©ÛŒ Ú¯ÙØª", "Ù†Ù…ÛŒÚ¯Ù…", "Ù†Ù…ÛŒØ¯ÙˆÙ†Ù…", "Ø¬Ø¹Ù„"
    ];

    const MAX_ATTEMPTS = 3;
    const MIN_WORDS_ACCEPT = 3;
    const MIN_CHARS_ACCEPT = 16;

    // ===== ÙˆØ¶Ø¹ÛŒØª =====
    let asked = [];
    let attempts = Number(localStorage.getItem('ai_guard_attempts') || 0);
    let suspicious = Number(localStorage.getItem('ai_guard_susp') || 0);

    // Ø§Ø¶Ø§ÙÙ‡â€ŒØ´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø±ÙØ¹ Ù…Ø´Ú©Ù„
    let followupMode = false;

    const aiPromptEl = document.getElementById('aiPrompt');
    const aiAnswerEl = document.getElementById('aiAnswer');
    const aiSubmitBtn = document.getElementById('aiSubmit');
    const aiCancelBtn = document.getElementById('aiCancel');
    const aiStatusEl = document.getElementById('aiStatus');
    const aiFollowEl = document.getElementById('aiFollow');

    // ===== ØªÙˆØ§Ø¨Ø¹ =====
    function pickQuestion() {
      const pool = AI_QUESTIONS.concat().filter(q => !asked.includes(q));
      if (pool.length === 0) asked = [];
      const q = pool[Math.floor(Math.random() * pool.length)];
      asked.push(q);
      return q;
    }

    function pickFollowup() {
      return FOLLOWUP_QUESTIONS[Math.floor(Math.random() * FOLLOWUP_QUESTIONS.length)];
    }

    function normalize(txt) {
      return txt.replace(/[^\p{L}\p{N}\s]/gu, ' ')
        .replace(/\s+/g, ' ')
        .trim()
        .toLowerCase();
    }

    function countWords(text) {
      return text ? text.split(/\s+/).filter(Boolean).length : 0;
    }

    function containsAny(text, arr) {
      return arr.some(a => text.includes(a));
    }

    function looksGibberish(text) {
      const letters = (text.match(/\p{L}/gu) || []).length;
      const total = text.length || 1;
      if (letters / total < 0.55) return true;

      const words = text.split(/\s+/).filter(Boolean);
      if (words.length === 1) return true;

      const shortWords = words.filter(w => w.length < 2).length;
      if (shortWords > words.length / 2) return true;

      return false;
    }

    function rejectAndRedirect(reason) {
      suspicious++;
      localStorage.setItem('ai_guard_susp', String(suspicious));
      aiFollowEl.textContent = 'Ù¾Ø§Ø³Ø® Ù…Ø´Ú©ÙˆÚ© ÛŒØ§ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯. Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡ Ø§Ù…Ù†...';
      setTimeout(() => window.location.href = "https://www.google.com", 900);
    }

    function acceptAndContinue() {
      localStorage.removeItem('ai_guard_attempts');
      localStorage.removeItem('ai_guard_susp');
      aiFollowEl.textContent = "Ù¾Ø§Ø³Ø® Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯ â€” Ø§Ø¯Ø§Ù…Ù‡...";
      if (typeof goTo === 'function' && typeof startCountdown === 'function') {
        goTo(4);
        startCountdown();
      }
    }

    function openAIGuard() {
      followupMode = false;
      aiStatusEl.textContent = `ØªÙ„Ø§Ø´â€ŒÙ‡Ø§: ${attempts}/${MAX_ATTEMPTS}`;
      aiFollowEl.textContent = '';
      aiAnswerEl.value = '';
      aiPromptEl.textContent = pickQuestion();
      aiAnswerEl.focus();
    }

    // ----------------- ØªØ§Ø¨Ø¹ Ù‡Ø´ SHA-256 -----------------
    async function hashText(txt) {
      const enc = new TextEncoder();
      const data = enc.encode(normalize(txt));
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    // ----------------- Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨ÙˆÙ„ÛŒ -----------------
    function getAcceptedList() {
      try {
        return JSON.parse(localStorage.getItem('accepted_answers') || '[]');
      } catch {
        return [];
      }
    }

    function saveAcceptedAnswerHash(hash) {
      const list = getAcceptedList();
      if (!list.includes(hash)) {
        list.push(hash);
        localStorage.setItem('accepted_answers', JSON.stringify(list));
      }
    }

    function isDuplicateAcceptedAnswer(hash) {
      return getAcceptedList().includes(hash);
    }

    // Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
    function clearAcceptedAnswers() {
      localStorage.removeItem('accepted_answers');
    }

    // ----------------- Ù…Ù†Ø·Ù‚ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø§ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø§Ø³Ø® ØªÚ©Ø±Ø§Ø±ÛŒ -----------------
    aiSubmitBtn.addEventListener('click', async () => {
      const raw = aiAnswerEl.value || '';
      const txt = normalize(raw);

      const txtHash = await hashText(txt);

      // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù¾Ø°ÛŒØ±ÙØªÙ‡â€ŒØ´Ø¯Ù‡
      if (isDuplicateAcceptedAnswer(txtHash)) {
        aiFollowEl.textContent = "Ø§ÛŒÙ† Ù¾Ø§Ø³Ø® Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ Ùˆ Ø¯ÛŒÚ¯Ø± Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ù¾Ø§Ø³Ø® Ø¬Ø¯ÛŒØ¯ Ø¨Ø¯Ù‡.";
        return;
      }

      attempts++;
      localStorage.setItem('ai_guard_attempts', String(attempts));
      aiStatusEl.textContent = `ØªÙ„Ø§Ø´â€ŒÙ‡Ø§: ${attempts}/${MAX_ATTEMPTS}`;

      // Ú©ÙˆØªØ§Ù‡ / Ø¨ÛŒâ€ŒÙ…Ø¹Ù†ÛŒ
      if (!txt || txt.length < MIN_CHARS_ACCEPT || countWords(txt) < MIN_WORDS_ACCEPT) {
        aiFollowEl.textContent = "Ù¾Ø§Ø³Ø®Øª Ø®ÛŒÙ„ÛŒ Ú©ÙˆØªØ§Ù‡Ù‡ØŒ ÙˆØ§Ø¶Ø­â€ŒØªØ± Ø¨Ù†ÙˆÛŒØ³.";
        if (attempts >= MAX_ATTEMPTS) return rejectAndRedirect("short");
        aiPromptEl.textContent = pickQuestion();
        return;
      }

      // Ù…Ù…Ù†ÙˆØ¹Ù‡â€ŒÙ‡Ø§
      if (containsAny(txt, REJECT_PATTERNS)) return rejectAndRedirect("forbidden");

      // Ø¨ÛŒâ€ŒÙ…Ø¹Ù†ÛŒ
      if (looksGibberish(raw)) {
        aiFollowEl.textContent = "Ù…ØªÙ† Ù†Ø§Ù…ÙÙ‡ÙˆÙ… Ø§Ø³Øª. ÙˆØ§Ø¶Ø­â€ŒØªØ± Ø¨Ù†ÙˆÛŒØ³.";
        if (attempts >= MAX_ATTEMPTS) return rejectAndRedirect("gibberish");
        aiPromptEl.textContent = pickQuestion();
        return;
      }

      // Ù†Ø´Ø§Ù†Ù‡ Ø¯Ø±ÙˆØº
      if (containsAny(txt, LIE_INDICATORS)) return rejectAndRedirect("lie");

      // Ù…Ø±Ø­Ù„Ù‡ Ø§ÙˆÙ„ â†’ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ
      if (!followupMode && containsAny(txt, ACCEPT_PATTERNS)) {
        followupMode = true;
        aiFollowEl.textContent = "Ù¾Ø§Ø³Ø® Ø§ÙˆÙ„ÛŒÙ‡ Ø®ÙˆØ¨ Ø§Ø³ØªØ› ÙÙ‚Ø· Ø§ÛŒÙ† Ø±Ø§ Ù‡Ù… Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù‡:";
        aiPromptEl.textContent = pickFollowup();
        return;
      }

      // Ù…Ø±Ø­Ù„Ù‡ Ø¯ÙˆÙ… â†’ Ù‚Ø¨ÙˆÙ„ Ù†Ù‡Ø§ÛŒÛŒ
      if (followupMode && containsAny(txt, ACCEPT_PATTERNS)) {
        saveAcceptedAnswerHash(txtHash);  // Ø°Ø®ÛŒØ±Ù‡ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ
        return acceptAndContinue();
      }

      // Ù…Ø¨Ù‡Ù… â†’ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÛŒØ¯
      aiFollowEl.textContent = "Ù¾Ø§Ø³Ø®Øª Ù…Ø´Ø®Øµ Ù†Ø¨ÙˆØ¯Ø› ÛŒÚ© Ø³ÙˆØ§Ù„ ØªÙˆØ¶ÛŒØ­ÛŒ Ø¯ÛŒÚ¯Ø±:";
      aiPromptEl.textContent = pickFollowup();

      if (attempts >= MAX_ATTEMPTS) return rejectAndRedirect("unclear");
    });


    // Ø§Ù†ØµØ±Ø§Ù
    aiCancelBtn.addEventListener('click', () => {
      window.location.href = "https://www.google.com";
    });

    // Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ
    openAIGuard();

    // Ù…Ø§Ù†ÛŒØªÙˆØ± ØµÙØ­Ù‡ step3
    const observer = new MutationObserver((mut) => {
      mut.forEach(m => {
        if (m.type === 'attributes' && m.attributeName === 'class') {
          const el = m.target;
          if (el && el.id === 'step3' && !el.classList.contains('hidden')) {
            openAIGuard();
          }
        }
      });
    });

    const step3el = document.getElementById('step3');
    if (step3el) observer.observe(step3el, { attributes: true });

  </script>
</body>

</html>
